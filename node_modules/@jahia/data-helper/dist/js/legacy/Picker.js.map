{"version":3,"names":["_react","_interopRequireDefault","require","_components","_graphqlTag","_fragments","_Picker","_rfdc","_fastDeepEqual","_templateObject","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","_createSuper","_isNativeReflectConstruct","_getPrototypeOf2","s","constructor","Reflect","construct","_possibleConstructorReturn2","Boolean","prototype","valueOf","call","clone","rfdc","Picker","exports","_React$Component","_inherits2","_super","props","_this","_classCallCheck2","fragments","rootPaths","onOpenItem","onSelectItem","openPaths","selectedPaths","defaultSelectedPaths","onSelectionChange","defaultOpenPaths","resolvedFragments","PickerItemsFragment","mixinTypes","primaryNodeType","isPublished","displayName","query","gql","_taggedTemplateLiteral2","nodeCacheRequiredFields","replaceFragmentsInDocument","state","eventsHandlers","isOpenControlled","path","open","setState","prevState","concat","_toConsumableArray2","thispath","addPathToOpenPath","isSelectControlled","selected","multiple","newSelectedPaths","bind","_assertThisInitialized2","_createClass2","key","value","getVariables","_this$props","openableTypes","selectableTypes","queryVariables","vars","types","Set","selectable","openable","assign","getPickerEntries","data","_this2","pickerEntries","nodesById","jcr","addNode","node","depth","index","indexOf","pickerNode","name","prefix","repeat","hidden","hasChildren","children","pageInfo","nodesCount","splice","uuid","rootNodes","rootNode","root","hideRoot","openNodes","sort","a","b","parent","parentIndex","nodes","slice","reverse","child","selectedNodes","map","pathsToOpen","rootFound","endsWith","_path$split","split","_path$split2","_toArray2","tail","reduce","acc","it","rootPath","startsWith","includes","paths","_this3","Array","render","_this4","setRefetch","createElement","Query","variables","fetchPolicy","result","error","loading","refetch","queryParams","renderProp","onLoading","previousEntries","getDerivedStateFromProps","nextProps","console","warn","newState","deepEquals","React","Component","_propTypes","array","arrayOf","string","func","isRequired","objectOf","any","bool"],"sources":["Picker.tsx"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\nimport React from 'react';\nimport {Query} from '@apollo/client/react/components';\nimport gql from 'graphql-tag';\nimport {displayName, Fragment, nodeCacheRequiredFields, replaceFragmentsInDocument} from '../fragments';\nimport {PickerItemsFragment} from './Picker.gql-fragments';\nimport {DocumentNode} from 'graphql';\nimport {QueryResult} from '@apollo/client';\nimport rfdc from 'rfdc';\nimport deepEquals from 'fast-deep-equal';\n\nconst clone = rfdc();\n\ntype PropType = {\n    /**\n     * Optional set of fragments to add to the graphQL query. Can be a string that identify a predefinedFragment or a fragment definition\n     */\n    fragments?: (string| Fragment)[],\n\n    /**\n     * List of root paths for the picker\n     */\n    rootPaths?: string[],\n\n    onOpenItem?: (path:string, open:boolean) => void\n\n    onSelectItem?: (path:string, selected: boolean, multiple:boolean) => void,\n\n    /**\n     * List of open folders in controlled mode\n     */\n    openPaths?: string[],\n\n    /**\n     * List of selected path in controlled mode\n     */\n    selectedPaths?: string[],\n\n    /**\n     * Preselected items path (uncontrolled mode)\n     */\n    defaultSelectedPaths?: string[],\n\n    /**\n     * Callback when the selection has changed\n     */\n    onSelectionChange?: (paths:string[]) => void,\n\n    /**\n     * List of folder paths that are open by default (uncontrolled mode)\n     */\n    defaultOpenPaths?: string[],\n\n    /**\n     * List of node types that can be \"opened\" (folders)\n     */\n    openableTypes?: string[],\n\n    /**\n     * List of node types that can be \"selected\" (items)\n     */\n    selectableTypes?: string[],\n\n    onLoading: (l: boolean) => void,\n\n    /**\n     * Optional set of variable to pass to the graphQL query, in order to fulfill fragments needs\n     */\n    queryVariables?: {[key:string]: any},\n\n    hideRoot?: boolean,\n\n    /**\n     * Optional function which receives refetch function of the Query component when the component is strapped\n     */\n    setRefetch: (p: any) => void,\n\n    children: (p: any) => React.ReactElement\n};\n\ntype StateType = {\n    isOpenControlled?: boolean,\n    isSelectControlled?: boolean,\n    openPaths?: string[],\n    selectedPaths?: string[]\n};\n\nexport class Picker extends React.Component<PropType, StateType> {\n    query: DocumentNode;\n    eventsHandlers: {onOpenItem?: (path:string, open:boolean) => void, onSelectItem?: (path:string, selected: boolean, multiple:boolean) => void};\n    previousEntries: any;\n\n    constructor(props: PropType) {\n        super(props);\n\n        const {\n            fragments,\n            rootPaths,\n            onOpenItem,\n            onSelectItem,\n            openPaths,\n            selectedPaths,\n            defaultSelectedPaths,\n            onSelectionChange,\n            defaultOpenPaths\n        } = props;\n\n        const resolvedFragments = fragments || [PickerItemsFragment.mixinTypes, PickerItemsFragment.primaryNodeType, PickerItemsFragment.isPublished, displayName];\n\n        this.query = gql`\n            query PickerQuery($rootPaths:[String!]!, $selectable:[String]!, $openable:[String]!, $openPaths:[String!]!, $types:[String]!) {\n                jcr {\n                    rootNodes:nodesByPath(paths: $rootPaths) {\n                        name\n                        children(typesFilter:{types:$types}, limit:1) {\n                            pageInfo {\n                                nodesCount\n                            }\n                        }\n                        selectable : isNodeType(type: {types:$selectable})\n                        openable : isNodeType(type: {types:$openable})\n                        ... NodeCacheRequiredFields\n                        ... node\n                    },\n                    openNodes:nodesByPath(paths: $openPaths) {\n                        ... NodeCacheRequiredFields\n                        children(typesFilter:{types:$types}) {\n                            nodes {\n                                name\n                                children(typesFilter:{types:$types}, limit:1) {\n                                    pageInfo {\n                                        nodesCount\n                                    }\n                                }\n                                selectable : isNodeType(type: {types:$selectable})\n                                openable : isNodeType(type: {types:$openable})\n                                ... NodeCacheRequiredFields\n                                ... node\n                            }\n                        }\n                    }\n                }\n            }\n        ${nodeCacheRequiredFields.gql}`;\n        this.query = replaceFragmentsInDocument(this.query, resolvedFragments);\n\n        const state: StateType = {};\n\n        this.eventsHandlers = {};\n\n        if (openPaths) {\n            state.isOpenControlled = true;\n            if (onOpenItem) {\n                this.eventsHandlers.onOpenItem = onOpenItem;\n            }\n        } else {\n            // Uncontrolled mode\n            state.isOpenControlled = false;\n            state.openPaths = [];\n            this.eventsHandlers.onOpenItem = (path, open) => {\n                this.setState(prevState => ({\n                    openPaths: open ?\n                        [...prevState.openPaths, path] :\n                        prevState.openPaths.filter(thispath => thispath !== path)\n                }));\n            };\n\n            if (defaultOpenPaths) {\n                state.openPaths = this.addPathToOpenPath(defaultOpenPaths, rootPaths, state.openPaths);\n            }\n        }\n\n        if (!selectedPaths) {\n            // Uncontrolled mode\n            state.isSelectControlled = false;\n            state.selectedPaths = defaultSelectedPaths ? clone(defaultSelectedPaths) : [];\n            // Open selected path if open is uncontrolled\n            if (defaultSelectedPaths && !state.isOpenControlled) {\n                state.openPaths = this.addPathToOpenPath(defaultSelectedPaths, rootPaths, state.openPaths);\n            }\n\n            this.eventsHandlers.onSelectItem = (path, selected, multiple) => {\n                this.setState(prevState => {\n                    const newSelectedPaths = selected ?\n                        [...(multiple ? prevState.selectedPaths : []), path] :\n                        prevState.selectedPaths.filter(thispath => thispath !== path);\n                    onSelectionChange(newSelectedPaths);\n                    return {\n                        selectedPaths: newSelectedPaths\n                    };\n                });\n            };\n        } else if (onSelectItem) {\n            state.isSelectControlled = true;\n            if (onSelectItem) {\n                this.eventsHandlers.onSelectItem = onSelectItem;\n            }\n        }\n\n        this.state = state;\n\n        // Binding\n        this.openPaths = this.openPaths.bind(this);\n    }\n\n    static getDerivedStateFromProps(nextProps: PropType, prevState: StateType) {\n        if ((prevState.isOpenControlled !== Boolean(nextProps.openPaths)) || (prevState.isSelectControlled !== Boolean(nextProps.selectedPaths))) {\n            console.warn('Cannot change between controlled/uncontrolled modes');\n        }\n\n        const newState: StateType = {};\n\n        if (prevState.isOpenControlled && !deepEquals(nextProps.openPaths, prevState.openPaths)) {\n            newState.openPaths = nextProps.openPaths;\n        }\n\n        if (prevState.isSelectControlled && !deepEquals(nextProps.selectedPaths, prevState.selectedPaths)) {\n            newState.selectedPaths = nextProps.selectedPaths;\n        }\n\n        if (newState.openPaths || newState.selectedPaths) {\n            return newState;\n        }\n\n        return null;\n    }\n\n    getVariables(selectedPaths: string[], openPaths: string[]) {\n        const {rootPaths, openableTypes, selectableTypes, queryVariables} = this.props;\n\n        const vars = {\n            rootPaths,\n            types: [...new Set([...openableTypes, ...selectableTypes])],\n            selectable: selectableTypes,\n            openable: openableTypes,\n            openPaths\n        };\n\n        if (queryVariables) {\n            Object.assign(vars, queryVariables);\n        }\n\n        return vars;\n    }\n\n    getPickerEntries(data: any, selectedPaths: string[], openPaths: string[]) {\n        let pickerEntries: any[] = [];\n        const nodesById:any = {};\n        const {jcr} = data;\n\n        const addNode = function (node:any, depth:number, index:number) {\n            let selected = false;\n            if (node.selectable) {\n                selected = selectedPaths.indexOf(node.path) !== -1;\n            }\n\n            const pickerNode = {\n                name: node.name,\n                path: node.path,\n                open: node.openable && openPaths.indexOf(node.path) !== -1,\n                selected,\n                openable: node.openable,\n                selectable: node.selectable,\n                depth,\n                prefix: '&nbsp;'.repeat(depth * 3),\n                node,\n                hidden: false,\n                hasChildren: node.children.pageInfo.nodesCount > 0\n            };\n            pickerEntries.splice(index, 0, pickerNode);\n            nodesById[node.uuid] = pickerNode;\n            return pickerNode;\n        };\n\n        if (jcr) {\n            if (jcr.rootNodes) {\n                jcr.rootNodes.forEach((rootNode: any) => {\n                    const root = addNode(rootNode, 0, 0);\n                    root.hidden = this.props.hideRoot || false;\n                });\n            }\n\n            if (jcr.openNodes) {\n                jcr.openNodes.concat()\n                    .sort((a: any, b: any) => (a.path > b.path) ? 1 : ((b.path > a.path) ? -1 : 0))\n                    .forEach((node: any) => {\n                        const parent = nodesById[node.uuid];\n                        if (parent) {\n                            const parentIndex = pickerEntries.indexOf(parent);\n                            node.children.nodes.slice().reverse().forEach((child: any) => {\n                                addNode(child, parent.depth + 1, parentIndex + 1);\n                            });\n                        }\n                    });\n            }\n        }\n\n        // Nodes loaded, fill selection list\n        const selectedNodes = pickerEntries.filter(node => node.selected).map(node => node.node);\n\n        selectedPaths = selectedNodes.map(s => s.path);\n        pickerEntries = pickerEntries.filter(pickerNode => !pickerNode.hidden);\n\n        return pickerEntries;\n    }\n\n    addPathToOpenPath(pathsToOpen: string[], rootPaths:string[], openPaths: string[]) {\n        pathsToOpen.forEach(path => {\n            let rootFound: false | string = false;\n            if (!path.endsWith('/')) {\n                path += '/';\n            }\n\n            const [...tail] = path.split('/');\n            tail.reduce((acc, it) => {\n                if (!rootFound) {\n                    rootPaths.forEach(rootPath => {\n                        rootFound = rootFound || (acc.startsWith(rootPath) && rootPath);\n                    });\n                }\n\n                if (rootFound && !openPaths.includes(acc)) {\n                    openPaths.push(acc);\n                    if (!openPaths.includes(rootFound)) {\n                        openPaths.push(rootFound);\n                    }\n                }\n\n                return acc + '/' + it;\n            }, '');\n        });\n        return openPaths;\n    }\n\n    openPaths(paths: string[]) {\n        if (!(paths instanceof Array)) {\n            paths = [paths];\n        }\n\n        this.setState(prevState => {\n            const openPaths = this.addPathToOpenPath(paths, this.props.rootPaths, prevState.openPaths);\n            return {openPaths};\n        });\n    }\n\n    render() {\n        const selectedPaths = this.state.selectedPaths ? this.state.selectedPaths : this.props.selectedPaths;\n        let openPaths = this.state.openPaths || this.props.openPaths;\n        const {setRefetch} = this.props;\n\n        openPaths = clone(openPaths);\n\n        const vars = this.getVariables(selectedPaths, openPaths);\n\n        return (\n            <Query query={this.query} variables={vars} fetchPolicy=\"cache-first\">\n                {(result: QueryResult): React.JSX.Element => {\n                    const {error, loading, data, refetch} = result;\n                    if (setRefetch) {\n                        setRefetch({\n                            query: this.query,\n                            queryParams: vars,\n                            refetch\n                        });\n                    }\n\n                    const renderProp = this.props.children;\n                    if (this.props.onLoading) {\n                        this.props.onLoading(loading);\n                    }\n\n                    if (loading) {\n                        if (this.previousEntries) {\n                            return renderProp({pickerEntries: this.previousEntries, loading, ...this.eventsHandlers});\n                        }\n\n                        return renderProp({pickerEntries: [], loading, ...this.eventsHandlers});\n                    }\n\n                    if (error) {\n                        return renderProp({pickerEntries: [], error, loading, ...this.eventsHandlers});\n                    }\n\n                    const pickerEntries = this.getPickerEntries(data, selectedPaths, openPaths);\n                    this.previousEntries = pickerEntries;\n\n                    return renderProp({pickerEntries, loading, ...this.eventsHandlers});\n                }}\n            </Query>\n        );\n    }\n}\n"],"mappings":"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","ignoreList":[]}