{"version":3,"names":["_react","require","_client","_useNodeInfo","_getPermissionFragment","_getIsNodeTypeFragment","_useNodeInfo2","_useMemoRequest3","_fastDeepEqual","_interopRequireDefault","_getSubNodesCountFragment","_excluded","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","queue","timeout","observedQueries","scheduleQueue","client","window","setTimeout","timeoutHandler","clearTimeout","mergedQueue","request","toInsert","variables","queryOptions","options","originals","mergeable","find","q","JSON","stringify","isSubset","merge","obs","unsubscribe","mergedRequest","query","generatedVariables","skip","getQuery","error","message","concat","setResult","loading","observableQuery","watchQuery","errorPolicy","subscription","subscribe","_ref","data","others","_objectWithoutProperties2","result","getResult","deepEquals","refetch","useNodeInfo","exports","_useState","useState","_useState2","_slicedToArray2","useApolloClient","_useMemoRequest","useMemoRequest","_useMemoRequest2","currentRequest","queryHasChanged","useEffect","splice","indexOf","fetchPolicy","infoQuery","res","readQuery","node","jcr","nodeByPath","nodeById","nodes","nodesByPath","nodesById","decodeResult","map","n","nodeOrig","site","getPermissions","name","getEncodedPermissionName","getSitePermissions","getIsNodeTypes","getEncodedNodeTypeName","getMimeType","resourceChildren","mimeType","value","getSubNodesCount","_res$pageInfo","getEncodedSubNodesCountName","pageInfo","totalCount"],"sources":["useNodeInfo.ts"],"sourcesContent":["import {useEffect, useState} from 'react';\nimport {ApolloClient, ApolloError, NetworkStatus, useApolloClient, WatchQueryOptions} from '@apollo/client';\nimport {getQuery, NodeInfoOptions} from './useNodeInfo.gql-queries';\nimport {getEncodedPermissionName} from '../../fragments/getPermissionFragment';\nimport {getEncodedNodeTypeName} from '../../fragments/getIsNodeTypeFragment';\nimport {isSubset, merge} from './useNodeInfo.utils';\nimport {useMemoRequest} from './useMemoRequest';\nimport deepEquals from 'fast-deep-equal';\nimport {DocumentNode, GraphQLError} from 'graphql';\nimport {getEncodedSubNodesCountName} from '../../fragments/getSubNodesCountFragment';\n\nexport type Request = {\n    variables:{[key:string]: any},\n    options: NodeInfoOptions,\n    queryOptions: Partial<WatchQueryOptions>,\n}\n\nexport type QueuedRequest = Request & {\n    result?: any,\n    setResult: (data: any) => void\n}\n\nexport type MergedRequest = Request & { originals: QueuedRequest[] };\n\nexport type NodeInfoResult = {\n    node?: any,\n    nodes?: any[],\n    errors?: readonly GraphQLError[],\n    error?: ApolloError,\n    loading?: boolean,\n    networkStatus?: NetworkStatus,\n    partial?: boolean,\n    query?: DocumentNode,\n    variables?: {[key:string]: any}\n}\n\nconst queue: QueuedRequest[] = [];\nlet timeout: number;\nlet observedQueries: { unsubscribe: () => void }[] = [];\n\nfunction scheduleQueue(client: ApolloClient<object>) {\n    if (!timeout) {\n        timeout = window.setTimeout(() => {\n            timeoutHandler(client);\n            clearTimeout(timeout);\n            timeout = null;\n        }, 0);\n    }\n}\n\nconst timeoutHandler = (client: ApolloClient<object>) => {\n    const mergedQueue: MergedRequest[] = [];\n\n    queue.forEach(request => {\n        const toInsert = {\n            variables: request.variables,\n            queryOptions: request.queryOptions,\n            options: request.options,\n            originals: [request]\n        };\n\n        const mergeable = mergedQueue.find(q => JSON.stringify(q.queryOptions) === JSON.stringify(toInsert.queryOptions) && (isSubset(q.variables, toInsert.variables) || isSubset(toInsert.variables, q.variables)));\n\n        if (mergeable) {\n            merge(mergeable, toInsert);\n        } else {\n            mergedQueue.push({\n                variables: toInsert.variables && {...toInsert.variables},\n                queryOptions: toInsert.queryOptions && {...toInsert.queryOptions},\n                options: toInsert.options && {...toInsert.options},\n                originals: toInsert.originals\n            });\n        }\n    });\n\n    observedQueries.forEach(obs => obs.unsubscribe());\n    observedQueries = [];\n\n    mergedQueue.forEach(mergedRequest => {\n        const {variables, queryOptions, options, originals} = mergedRequest;\n        let query: any;\n        let generatedVariables: any;\n        let skip;\n\n        try {\n            const r = getQuery(variables, options);\n            query = r.query;\n            generatedVariables = r.generatedVariables;\n            skip = r.skip;\n        } catch (e) {\n            const error = {message: `One of the batched queries resulted in error: ${e.message}`} as ApolloError;\n            originals.forEach(request => {\n                request.setResult({\n                    loading: false,\n                    error\n                });\n            });\n        }\n\n        if (skip) {\n            // No query to execute\n            originals.forEach(request => {\n                request.setResult({\n                    loading: false\n                });\n            });\n        } else {\n            const observableQuery = client.watchQuery({query, errorPolicy: 'ignore', ...queryOptions, variables: generatedVariables});\n            const subscription = observableQuery.subscribe(({data, ...others}) => {\n                const result = getResult(data, others, options, query, generatedVariables);\n                originals.forEach(request => {\n                    if (!deepEquals(request.result, result)) {\n                        request.result = result;\n                        request.setResult({\n                            ...result,\n                            refetch() {\n                                return observableQuery.refetch(generatedVariables);\n                            }\n                        });\n                    }\n                });\n            });\n            observedQueries.push(subscription);\n        }\n    });\n};\n\nexport const useNodeInfo = (variables: {[key:string]: unknown}, options?: NodeInfoOptions, queryOptions?: Partial<WatchQueryOptions>) => {\n    const [result, setResult] = useState<NodeInfoResult>({\n        loading: true\n    });\n\n    const client = useApolloClient();\n\n    // Normalize and memoize request\n    const [currentRequest, queryHasChanged] = useMemoRequest(variables, queryOptions, options, setResult);\n    useEffect(() => {\n        queue.push(currentRequest);\n        scheduleQueue(client);\n\n        return () => {\n            queue.splice(queue.indexOf(currentRequest), 1);\n        };\n    }, [client, currentRequest]);\n\n    if (queryHasChanged && queryOptions?.fetchPolicy !== 'no-cache' && queryOptions?.fetchPolicy !== 'network-only') {\n        let infoQuery;\n\n        try {\n            infoQuery = getQuery(currentRequest.variables, currentRequest.options);\n        } catch (e) {\n            const error = {message: e.message} as ApolloError;\n            return {loading: false, error};\n        }\n\n        const res = client.readQuery({query: infoQuery.query, variables: infoQuery.generatedVariables});\n        if (res) {\n            const result = getResult(res, {}, currentRequest.options, infoQuery.query, infoQuery.generatedVariables);\n            setResult(result);\n            return result;\n        }\n    }\n\n    if (queryHasChanged && !result.loading) {\n        setResult({\n            loading: true\n        });\n        return {loading: true};\n    }\n\n    return result;\n};\n\n/* eslint-disable max-params */\nconst getResult = (data: any, others: NodeInfoResult, options: NodeInfoOptions, query: DocumentNode, generatedVariables: {[key:string]: unknown}) => {\n    const node: object = (data && data.jcr && (data.jcr.nodeByPath || data.jcr.nodeById)) || null;\n    const nodes: object[] = (data && data.jcr && (data.jcr.nodesByPath || data.jcr.nodesById)) || null;\n    let result = others;\n\n    if (node) {\n        result = {\n            node: decodeResult(node, options),\n            ...others,\n            query,\n            variables: generatedVariables\n        };\n    }\n\n    if (nodes) {\n        result = {\n            nodes: nodes.map(n => decodeResult(n, options)),\n            ...others,\n            query,\n            variables: generatedVariables\n        };\n    }\n\n    return result;\n};\n\nconst decodeResult = (nodeOrig: any, options: NodeInfoOptions) => {\n    const node = {...nodeOrig};\n    if (node.site) {\n        node.site = {...node.site};\n    }\n\n    if (node && options) {\n        if (options.getPermissions) {\n            options.getPermissions.forEach(name => {\n                const res = node[getEncodedPermissionName(name)];\n                delete node[getEncodedPermissionName(name)];\n                node[name] = res;\n            });\n        }\n\n        if (options.getSitePermissions) {\n            options.getSitePermissions.forEach(name => {\n                const res = node.site[getEncodedPermissionName(name)];\n                delete node.site[getEncodedPermissionName(name)];\n                node.site[name] = res;\n            });\n        }\n\n        if (options.getIsNodeTypes) {\n            options.getIsNodeTypes.forEach(name => {\n                const res = node[getEncodedNodeTypeName(name)];\n                delete node[getEncodedNodeTypeName(name)];\n                node[name] = res;\n            });\n        }\n\n        if (options.getMimeType) {\n            const {nodes} = node.resourceChildren;\n            node.mimeType = (nodes.length !== 0 && nodes[0].mimeType.value) || null;\n            delete node.resourceChildren;\n        }\n\n        if (options.getSubNodesCount) {\n            options.getSubNodesCount.forEach(name => {\n                const res = node[getEncodedSubNodesCountName(name)];\n                delete node[getEncodedSubNodesCountName(name)];\n                node['subNodesCount_' + name] = res?.pageInfo?.totalCount;\n            });\n        }\n    }\n\n    return node;\n};\n"],"mappings":"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","ignoreList":[]}