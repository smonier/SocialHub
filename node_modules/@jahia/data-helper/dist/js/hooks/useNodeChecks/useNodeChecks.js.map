{"version":3,"names":["_","require","_excluded","_excluded2","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","evaluateVisibilityPaths","visible","visibilityPaths","nodePath","i","RegExp","test","addArrayOptionValues","newValue","useNodeInfoOptions","useNodeInfoKey","concat","item","indexOf","useNodeChecks","exports","variables","options","queryOptions","requiredPermission","requiredSitePermission","showOnNodeTypes","hideOnNodeTypes","requireModuleInstalledOnSite","showForPaths","hideForPaths","hideOnExternal","othersOptions","_objectWithoutProperties2","requiredPermissions","requiredSitePermissions","getSiteInstalledModules","_useNodeInfo","useNodeInfo","node","nodes","loading","othersResults","checksResult","doNodeCheck","currentNode","reduce","acc","val","site","installedModulesWithAllDependencies","includes","path","isExternal","result"],"sources":["useNodeChecks.ts"],"sourcesContent":["import {NodeInfoResult, useNodeInfo} from '~/hooks';\nimport {NodeInfoOptions} from '../useNodeInfo/useNodeInfo.gql-queries';\nimport {WatchQueryOptions} from '@apollo/client';\n\nexport type NodeCheckOptions = NodeInfoOptions & Partial<{\n    requiredPermission: string | string[],\n    requiredSitePermission: string | string[],\n    showOnNodeTypes: string[],\n    hideOnNodeTypes: string[],\n    requireModuleInstalledOnSite: string[],\n    showForPaths: string[],\n    hideForPaths: string[],\n    hideOnExternal: boolean\n}>\n\nexport type NodeCheckResult = NodeInfoResult & Partial<{\n    checksResult: boolean,\n}>\n\nconst evaluateVisibilityPaths = (visible: boolean, visibilityPaths: string[], nodePath: string) => {\n    for (let i = 0; i < visibilityPaths.length; i++) {\n        if (new RegExp(visibilityPaths[i]).test(nodePath)) {\n            return visible;\n        }\n    }\n\n    return !visible;\n};\n\nfunction addArrayOptionValues(newValue: string[], useNodeInfoOptions: NodeInfoOptions, useNodeInfoKey: 'getPermissions' | 'getSitePermissions' |'getIsNodeTypes'| 'getProperties') {\n    if (newValue) {\n        useNodeInfoOptions[useNodeInfoKey] = useNodeInfoOptions[useNodeInfoKey] || [];\n        useNodeInfoOptions[useNodeInfoKey] = useNodeInfoOptions[useNodeInfoKey].concat(newValue.filter(item => useNodeInfoOptions[useNodeInfoKey].indexOf(item) < 0));\n    }\n}\n\nexport const useNodeChecks = (variables: {[key:string]: any}, options?: NodeCheckOptions, queryOptions?: WatchQueryOptions): NodeCheckResult => {\n    const {requiredPermission, requiredSitePermission, showOnNodeTypes, hideOnNodeTypes, requireModuleInstalledOnSite, showForPaths, hideForPaths, hideOnExternal, ...othersOptions} = options;\n    const useNodeInfoOptions = {...othersOptions};\n\n    const requiredPermissions = (typeof requiredPermission === 'string') ? [requiredPermission] : requiredPermission;\n    const requiredSitePermissions = (typeof requiredSitePermission === 'string') ? [requiredSitePermission] : requiredSitePermission;\n\n    addArrayOptionValues(requiredPermissions, useNodeInfoOptions, 'getPermissions');\n    addArrayOptionValues(requiredSitePermissions, useNodeInfoOptions, 'getSitePermissions');\n    addArrayOptionValues(showOnNodeTypes, useNodeInfoOptions, 'getIsNodeTypes');\n    addArrayOptionValues(hideOnNodeTypes, useNodeInfoOptions, 'getIsNodeTypes');\n\n    if (requireModuleInstalledOnSite) {\n        useNodeInfoOptions.getSiteInstalledModules = true;\n    }\n\n    const {node, nodes, loading, ...othersResults} = useNodeInfo(variables, useNodeInfoOptions, queryOptions);\n\n    if (loading) {\n        return {loading, ...othersResults};\n    }\n\n    if (!node && !nodes) {\n        return {checksResult: false, loading, ...othersResults};\n    }\n\n    const doNodeCheck = (currentNode: any) =>\n        (!requiredPermissions || requiredPermissions.reduce((acc, val) => acc || currentNode[val], false)) &&\n        (!requiredSitePermissions || requiredSitePermissions.reduce((acc, val) => acc || currentNode.site[val], false)) &&\n        (!showOnNodeTypes || showOnNodeTypes.reduce((acc, val) => acc || currentNode[val], false)) &&\n        (!hideOnNodeTypes || !hideOnNodeTypes.reduce((acc, val) => acc || currentNode[val], false)) &&\n        (!requireModuleInstalledOnSite || requireModuleInstalledOnSite.reduce((acc, val) => acc && currentNode.site.installedModulesWithAllDependencies.includes(val), true)) &&\n        (!hideForPaths || evaluateVisibilityPaths(false, hideForPaths, currentNode.path || variables.path)) &&\n        (!showForPaths || evaluateVisibilityPaths(true, showForPaths, currentNode.path || variables.path)) &&\n        (!hideOnExternal || !currentNode.isExternal);\n\n    const result = node ? doNodeCheck(node) : nodes.reduce((acc, val) => acc && doNodeCheck(val), true);\n\n    return {node, nodes, checksResult: result, loading, ...othersResults};\n};\n"],"mappings":"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","ignoreList":[]}